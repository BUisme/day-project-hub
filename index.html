<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Secret Message Link + Reply + QR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- QRCode library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    .container {
      width: 100%;
      max-width: 760px;
      background: #020617;
      border-radius: 16px;
      padding: 20px 20px 24px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
      border: 1px solid #1f2937;
    }
    h1 {
      margin: 0 0 12px;
      font-size: 1.4rem;
      color: #f9fafb;
    }
    p.desc {
      margin: 0 0 16px;
      color: #9ca3af;
      font-size: 0.9rem;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-size: 0.9rem;
      color: #e5e7eb;
    }
    input[type="text"],
    input[type="url"],
    textarea {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
      outline: none;
    }
    input:focus,
    textarea:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56,189,248,0.4);
    }
    textarea {
      min-height: 130px;
      resize: vertical;
    }
    .field-group {
      margin-bottom: 14px;
    }
    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .row .field-group {
      flex: 1 1 0;
      margin-bottom: 0;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 10px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: radial-gradient(circle at top left, #38bdf8, #4f46e5);
      color: white;
      font-weight: 500;
      margin-top: 6px;
    }
    button.secondary {
      background: #111827;
      border: 1px solid #374151;
      color: #e5e7eb;
    }
    button:active {
      transform: translateY(1px);
    }
    .output-link {
      margin-top: 12px;
      padding: 10px 12px;
      background: #020617;
      border-radius: 10px;
      border: 1px dashed #4b5563;
    }
    .output-link label {
      margin-bottom: 4px;
    }
    .output-link-inner {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .output-link-inner input {
      flex: 1;
    }
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      background: #111827;
      border: 1px solid #1d4ed8;
      color: #bfdbfe;
      margin-bottom: 8px;
    }
    .view-card {
      padding: 14px 14px 16px;
      border-radius: 14px;
      background: radial-gradient(circle at top left, rgba(56,189,248,0.12), transparent),
                  #020617;
      border: 1px solid #1f2937;
    }
    .message-text {
      white-space: pre-wrap;
      word-break: break-word;
      font-size: 0.98rem;
      line-height: 1.6;
      margin-bottom: 14px;
    }
    .section-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: #9ca3af;
      margin: 10px 0 4px;
    }
    .chip-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }
    .chip {
      font-size: 0.8rem;
      padding: 5px 10px;
      border-radius: 999px;
      background: #030712;
      border: 1px solid #374151;
      color: #e5e7eb;
    }
    .chip a {
      color: inherit;
      text-decoration: none;
    }
    .chip a:hover {
      text-decoration: underline;
    }
    .counter {
      margin-top: 8px;
      font-size: 0.78rem;
      color: #9ca3af;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .counter span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }
    .small-muted {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 4px;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    .top-bar-right {
      font-size: 0.75rem;
      color: #6b7280;
    }
    .link-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      text-decoration: none;
      padding: 8px 13px;
      border-radius: 999px;
      background: #111827;
      border: 1px solid #4b5563;
      font-size: 0.82rem;
      color: #e5e7eb;
      margin-top: 4px;
    }
    .link-btn:hover {
      border-color: #38bdf8;
    }
    .reply-box {
      margin-top: 14px;
      padding-top: 10px;
      border-top: 1px dashed #4b5563;
    }
    .reply-inner {
      margin-top: 8px;
      padding: 10px 10px 12px;
      border-radius: 12px;
      background: #020617;
      border: 1px solid #1f2937;
    }
    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.72rem;
      background: #111827;
      color: #9ca3af;
      margin-bottom: 6px;
    }
    .qr-wrapper {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .qr-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    .qr-box {
      padding: 8px;
      border-radius: 12px;
      background: #020617;
      border: 1px dashed #374151;
    }
    .qr-label {
      font-size: 0.78rem;
      color: #9ca3af;
    }

    @media (max-width: 480px) {
      .container { padding: 16px; }
      h1 { font-size: 1.2rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- EDIT MODE (‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å) -->
    <div id="edit-mode" style="display:none;">
      <div class="top-bar">
        <div>
          <h1>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå</h1>
          <p class="desc">
            ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏û‡∏•‡∏á ‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏î "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏Å‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏≠‡πà‡∏≤‡∏ô
          </p>
        </div>
        <div class="top-bar-right">
          ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå
        </div>
      </div>

      <div class="field-group">
        <label for="message">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</label>
        <textarea id="message" placeholder="‡πÉ‡∏™‡πà‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ ‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏≠‡∏Å‡∏£‡∏±‡∏Å ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©"></textarea>
      </div>

      <div class="field-group">
        <label for="songUrl">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏û‡∏•‡∏á (YouTube / Spotify ‡∏Ø‡∏•‡∏Ø)</label>
        <input id="songUrl" type="url" placeholder="https://youtube.com/..., https://open.spotify.com/..." />
      </div>

      <div class="section-title">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</div>
      <div class="row">
        <div class="field-group">
          <label for="facebook">Facebook URL</label>
          <input id="facebook" type="url" placeholder="https://facebook.com/‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà)" />
        </div>
        <div class="field-group">
          <label for="instagram">Instagram URL</label>
          <input id="instagram" type="url" placeholder="https://instagram.com/‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡∏à‡∏µ (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà)" />
        </div>
      </div>
      <div class="field-group">
        <label for="lineId">LINE ID</label>
        <input id="lineId" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô day_123 (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà)" />
      </div>

      <button id="generateBtn">‚ú® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô</button>

      <div id="outputArea" class="output-link" style="display:none;">
        <label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ</label>
        <div class="output-link-inner">
          <input id="shareLink" type="text" readonly />
          <button id="copyBtn" class="secondary">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
        </div>

        <div class="qr-wrapper">
          <div class="qr-label">‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡∏≤‡∏Å QR code ‡∏ô‡∏µ‡πâ‡∏Å‡πá‡πÑ‡∏î‡πâ</div>
          <div class="qr-row">
            <div id="qrcodeMain" class="qr-box"></div>
            <a class="link-btn" href="https://bitly.com/" target="_blank" rel="noopener noreferrer">
              ‚Üó ‡πÑ‡∏õ‡πÄ‡∏ß‡πá‡∏ö‡∏¢‡πà‡∏≠‡∏•‡∏¥‡∏á‡∏Å‡πå (‡πÄ‡∏ä‡πà‡∏ô bitly)
            </a>
          </div>
        </div>

        <div class="small-muted">
          ‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô / ‡∏Ñ‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        </div>
      </div>
    </div>

    <!-- VIEW MODE (‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏î‡∏π) -->
    <div id="view-mode" style="display:none;">
      <div class="top-bar">
        <div>
          <span class="badge">Message Viewer</span>
          <h1>‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏∏‡∏ì</h1>
        </div>
        <div class="top-bar-right">
          ‡πÇ‡∏´‡∏°‡∏î‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        </div>
      </div>

      <div class="view-card">
        <div id="messageText" class="message-text"></div>

        <div id="songSection" style="display:none;">
          <div class="section-title">‡πÄ‡∏û‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ</div>
          <a id="songLink" class="link-btn" href="#" target="_blank" rel="noopener noreferrer">
            üîó ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏á
          </a>
          <div class="small-muted">
            ‡∏ñ‡πâ‡∏≤‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå
          </div>
        </div>

        <div id="contactSection" style="display:none; margin-top:10px;">
          <div class="section-title">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</div>
          <div class="chip-list" id="chipList"></div>
        </div>

        <div id="counterBox" class="counter">
          <span class="dot"></span>
          <span id="counterText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏¥‡∏î...</span>
        </div>
        <div class="small-muted">
          ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏±‡πâ‡∏ô)
        </div>

        <!-- REPLY BOX -->
        <div class="reply-box">
          <button id="toggleReply" class="secondary">üíå ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ</button>

          <div id="replyForm" class="reply-inner" style="display:none;">
            <div class="tag">Reply Mode</div>
            <div class="small-muted">
              ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö" ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡∏´‡∏≤‡∏Ñ‡∏∏‡∏ì
            </div>

            <div class="field-group">
              <label for="replyMessage">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</label>
              <textarea id="replyMessage" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ñ‡∏∂‡∏á‡∏≠‡∏µ‡∏Å‡∏ù‡πà‡∏≤‡∏¢"></textarea>
            </div>

            <div class="field-group">
              <label for="replySongUrl">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏û‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
              <input id="replySongUrl" type="url" placeholder="https://youtube.com/..., https://open.spotify.com/..." />
            </div>

            <div class="section-title">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>
            <div class="row">
              <div class="field-group">
                <label for="replyFacebook">Facebook URL</label>
                <input id="replyFacebook" type="url" placeholder="https://facebook.com/‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏∏‡∏ì" />
              </div>
              <div class="field-group">
                <label for="replyInstagram">Instagram URL</label>
                <input id="replyInstagram" type="url" placeholder="https://instagram.com/‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡∏à‡∏µ‡∏Ñ‡∏∏‡∏ì" />
              </div>
            </div>
            <div class="field-group">
              <label for="replyLineId">LINE ID</label>
              <input id="replyLineId" type="text" placeholder="LINE ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" />
            </div>

            <button id="generateReplyBtn">‚ú® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</button>

            <div id="replyOutputArea" class="output-link" style="display:none;">
              <label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</label>
              <div class="output-link-inner">
                <input id="replyShareLink" type="text" readonly />
                <button id="replyCopyBtn" class="secondary">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
              </div>

              <div class="qr-wrapper">
                <div class="qr-label">‡∏≠‡∏µ‡∏Å‡∏ù‡πà‡∏≤‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡∏≤‡∏Å QR code ‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</div>
                <div class="qr-row">
                  <div id="qrcodeReply" class="qr-box"></div>
                  <a class="link-btn" href="https://bitly.com/" target="_blank" rel="noopener noreferrer">
                    ‚Üó ‡πÑ‡∏õ‡πÄ‡∏ß‡πá‡∏ö‡∏¢‡πà‡∏≠‡∏•‡∏¥‡∏á‡∏Å‡πå (‡πÄ‡∏ä‡πà‡∏ô bitly)
                  </a>
                </div>
              </div>

              <div class="small-muted">
                ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR code ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏Å‡∏°‡∏≤‡∏´‡∏≤‡∏Ñ‡∏∏‡∏ì
              </div>
            </div>
          </div>
        </div>
      </div>

      <button id="backToCreate" class="secondary" style="margin-top:10px;">‚¨ÖÔ∏è ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á</button>
    </div>
  </div>

  <script>
    // -------------------------------
    // Helper: ‡∏≠‡πà‡∏≤‡∏ô query param
    // -------------------------------
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    // -------------------------------
    // Helper: ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ / ‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    // -------------------------------
    function encodeData(dataObj) {
      const json = JSON.stringify(dataObj);
      return encodeURIComponent(json);
    }

    function decodeData(encoded) {
      try {
        const json = decodeURIComponent(encoded);
        return JSON.parse(json);
      } catch (e) {
        console.error("Decode error:", e);
        return null;
      }
    }

    // -------------------------------
    // Helper: ‡∏™‡∏£‡πâ‡∏≤‡∏á hash ‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‡∏à‡∏≤‡∏Å string
    // ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô messageId ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏õ‡∏¥‡∏î
    // -------------------------------
    function simpleHash(str) {
      let hash = 0, i, chr;
      if (str.length === 0) return "0";
      for (i = 0; i < str.length; i++) {
        chr = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + chr;
        hash |= 0;
      }
      return Math.abs(hash).toString();
    }

    // -------------------------------
    // View Counter (‡πÉ‡∏ä‡πâ countapi.xyz)
    // -------------------------------
    async function setupViewCounter(messageId) {
      const counterBox = document.getElementById("counterBox");
      const counterText = document.getElementById("counterText");
      if (!counterBox) return;

      const localKey = "seen_" + messageId;
      const namespace = "day-secret-message-app";

      let alreadySeen = false;
      try {
        alreadySeen = !!localStorage.getItem(localKey);
      } catch (e) {}

      try {
        let url;
        if (alreadySeen) {
          url = `https://api.countapi.xyz/get/${namespace}/${messageId}`;
        } else {
          url = `https://api.countapi.xyz/hit/${namespace}/${messageId}`;
        }

        const res = await fetch(url);
        if (!res.ok) throw new Error("Counter API error");
        const data = await res.json();
        const count = data.value ?? data.count ?? 0;
        counterText.textContent = `‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß ${count.toLocaleString("th-TH")} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;

        if (!alreadySeen) {
          try {
            localStorage.setItem(localKey, "1");
          } catch (e) {}
        }
      } catch (e) {
        console.warn("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ:", e);
        counterText.textContent = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ (‡πÅ‡∏ï‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥)";
      }
    }

    // -------------------------------
    // ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (View Mode)
    // -------------------------------
    function initViewMode(data) {
      const editMode = document.getElementById("edit-mode");
      const viewMode = document.getElementById("view-mode");
      editMode.style.display = "none";
      viewMode.style.display = "block";

      const msgEl = document.getElementById("messageText");
      msgEl.textContent = data.message || "(‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°)";

      // ‡πÄ‡∏û‡∏•‡∏á
      const songSection = document.getElementById("songSection");
      const songLink = document.getElementById("songLink");
      if (data.songUrl && data.songUrl.trim() !== "") {
        songLink.href = data.songUrl.trim();
        songSection.style.display = "block";
      } else {
        songSection.style.display = "none";
      }

      // ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
      const contactSection = document.getElementById("contactSection");
      const chipList = document.getElementById("chipList");
      chipList.innerHTML = "";
      let hasContact = false;

      if (data.facebook && data.facebook.trim() !== "") {
        hasContact = true;
        const chip = document.createElement("div");
        chip.className = "chip";
        const a = document.createElement("a");
        a.href = data.facebook.trim();
        a.target = "_blank";
        a.rel = "noopener noreferrer";
        a.textContent = "Facebook";
        chip.appendChild(a);
        chipList.appendChild(chip);
      }

      if (data.instagram && data.instagram.trim() !== "") {
        hasContact = true;
        const chip = document.createElement("div");
        chip.className = "chip";
        const a = document.createElement("a");
        a.href = data.instagram.trim();
        a.target = "_blank";
        a.rel = "noopener noreferrer";
        a.textContent = "Instagram";
        chip.appendChild(a);
        chipList.appendChild(chip);
      }

      if (data.lineId && data.lineId.trim() !== "") {
        hasContact = true;
        const chip = document.createElement("div");
        chip.className = "chip";
        chip.textContent = "LINE: " + data.lineId.trim();
        chipList.appendChild(chip);
      }

      contactSection.style.display = hasContact ? "block" : "none";

      // View counter
      const messageId = simpleHash(JSON.stringify(data));
      setupViewCounter(messageId);

      // ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ create ‡πÉ‡∏´‡∏°‡πà
      document.getElementById("backToCreate").addEventListener("click", () => {
        const baseUrl = window.location.origin + window.location.pathname;
        window.location.href = baseUrl;
      });

      // -------------------------
      // REPLY MODE
      // -------------------------
      const toggleReplyBtn = document.getElementById("toggleReply");
      const replyForm = document.getElementById("replyForm");
      const generateReplyBtn = document.getElementById("generateReplyBtn");
      const replyOutputArea = document.getElementById("replyOutputArea");
      const replyShareLinkInput = document.getElementById("replyShareLink");
      const replyCopyBtn = document.getElementById("replyCopyBtn");

      toggleReplyBtn.addEventListener("click", () => {
        if (replyForm.style.display === "none") {
          replyForm.style.display = "block";
          toggleReplyBtn.textContent = "‚ùå ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö";
        } else {
          replyForm.style.display = "none";
          toggleReplyBtn.textContent = "üíå ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ";
        }
      });

      generateReplyBtn.addEventListener("click", () => {
        const replyMessage = document.getElementById("replyMessage").value.trim();
        const replySongUrl = document.getElementById("replySongUrl").value.trim();
        const replyFacebook = document.getElementById("replyFacebook").value.trim();
        const replyInstagram = document.getElementById("replyInstagram").value.trim();
        const replyLineId = document.getElementById("replyLineId").value.trim();

        if (!replyMessage) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î");
          return;
        }

        const replyData = {
          message: replyMessage,
          songUrl: replySongUrl,
          facebook: replyFacebook,
          instagram: replyInstagram,
          lineId: replyLineId,
          replyTo: messageId
        };

        const encoded = encodeData(replyData);
        const baseUrl = window.location.origin + window.location.pathname;
        const shareUrl = `${baseUrl}?d=${encoded}`;

        replyShareLinkInput.value = shareUrl;
        replyOutputArea.style.display = "block";

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
        const qrReplyDiv = document.getElementById("qrcodeReply");
        if (qrReplyDiv) {
          qrReplyDiv.innerHTML = "";
          new QRCode(qrReplyDiv, {
            text: shareUrl,
            width: 160,
            height: 160
          });
        }
      });

      replyCopyBtn.addEventListener("click", async () => {
        replyShareLinkInput.select();
        replyShareLinkInput.setSelectionRange(0, 99999);
        try {
          await navigator.clipboard.writeText(replyShareLinkInput.value);
          replyCopyBtn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß";
          setTimeout(() => replyCopyBtn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å", 1500);
        } catch (e) {
          document.execCommand("copy");
          replyCopyBtn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß";
          setTimeout(() => replyCopyBtn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å", 1500);
        }
      });
    }

    // -------------------------------
    // ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå (‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)
    // -------------------------------
    function initEditMode() {
      const editMode = document.getElementById("edit-mode");
      const viewMode = document.getElementById("view-mode");
      editMode.style.display = "block";
      viewMode.style.display = "none";

      const generateBtn = document.getElementById("generateBtn");
      const outputArea = document.getElementById("outputArea");
      const shareLinkInput = document.getElementById("shareLink");
      const copyBtn = document.getElementById("copyBtn");

      generateBtn.addEventListener("click", () => {
        const message = document.getElementById("message").value.trim();
        const songUrl = document.getElementById("songUrl").value.trim();
        const facebook = document.getElementById("facebook").value.trim();
        const instagram = document.getElementById("instagram").value.trim();
        const lineId = document.getElementById("lineId").value.trim();

        if (!message) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏∞");
          return;
        }

        const data = { message, songUrl, facebook, instagram, lineId };
        const encoded = encodeData(data);

        const baseUrl = window.location.origin + window.location.pathname;
        const shareUrl = `${baseUrl}?d=${encoded}`;

        shareLinkInput.value = shareUrl;
        outputArea.style.display = "block";

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏´‡∏•‡∏±‡∏Å
        const qrDiv = document.getElementById("qrcodeMain");
        if (qrDiv) {
          qrDiv.innerHTML = "";
          new QRCode(qrDiv, {
            text: shareUrl,
            width: 160,
            height: 160
          });
        }
      });

      copyBtn.addEventListener("click", async () => {
        shareLinkInput.select();
        shareLinkInput.setSelectionRange(0, 99999);
        try {
          await navigator.clipboard.writeText(shareLinkInput.value);
          copyBtn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß";
          setTimeout(() => copyBtn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å", 1500);
        } catch (e) {
          document.execCommand("copy");
          copyBtn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß";
          setTimeout(() => copyBtn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å", 1500);
        }
      });
    }

    // -------------------------------
    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    // -------------------------------
    (function init() {
      const d = getQueryParam("d");
      if (d) {
        const data = decodeData(d);
        if (data && typeof data === "object") {
          initViewMode(data);
          return;
        }
      }
      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ d ‡∏´‡∏£‡∏∑‡∏≠ decode ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ -> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ create
      initEditMode();
    })();
  </script>
</body>
</html>
